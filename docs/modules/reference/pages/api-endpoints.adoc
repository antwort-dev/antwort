= API Endpoints
:navtitle: API Endpoints

Antwort implements the https://platform.openai.com/docs/api-reference/responses[OpenAI Responses API] and exposes additional operational endpoints for health checking and metrics.
This page documents every HTTP endpoint with its method, path, request body, response format, and status codes.

== Responses API

=== POST /v1/responses

Creates a new model response.
This is the primary endpoint for sending prompts to the inference backend.

**Request body** (JSON):

[cols="2,1,3"]
|===
| Field | Type | Description

| `model`
| string
| Model identifier. Falls back to `engine.default_model` if omitted.

| `input`
| array
| List of input items (messages, function call outputs).

| `instructions`
| string
| System-level instructions prepended to the conversation.

| `tools`
| array
| Tool definitions (function, MCP, or built-in tools).

| `tool_choice`
| string/object
| Controls tool selection: `auto`, `none`, `required`, or a specific tool.

| `stream`
| bool
| When `true`, the response is streamed as Server-Sent Events (SSE).

| `previous_response_id`
| string
| ID of a previous response for conversation chaining.

| `store`
| bool
| Whether to persist this response in storage.

| `max_output_tokens`
| int
| Maximum number of tokens in the model output.

| `temperature`
| float
| Sampling temperature (0.0 to 2.0).

| `top_p`
| float
| Nucleus sampling threshold.

| `metadata`
| object
| Arbitrary key-value metadata attached to the response.

| `reasoning`
| object
| Reasoning configuration with `effort` and `summary` fields.

| `text`
| object
| Structured output configuration with `format` field.
|===

**Non-streaming response** (`stream: false` or omitted):

Returns a complete `Response` object with `Content-Type: application/json`.

**Streaming response** (`stream: true`):

Returns a stream of Server-Sent Events with `Content-Type: text/event-stream`.
Each event has the format:

----
event: <event_type>
data: <json_payload>
----

Key event types include `response.created`, `response.output_item.added`, `response.output_text.delta`, `response.output_text.done`, `response.completed`, and `response.failed`.

**Status codes:**

[cols="1,3"]
|===
| Code | Meaning

| 200
| Success (non-streaming or streaming start).

| 400
| Invalid request (malformed JSON, missing fields).

| 413
| Request body too large (exceeds 10 MB limit).

| 415
| Unsupported Content-Type (must be `application/json`).

| 500
| Internal server error.
|===

=== GET /v1/responses/\{id}

Retrieves a previously stored response by ID.
Requires a storage backend to be configured.

**Path parameters:**

* `id` (string): The response ID (format: `resp_` followed by 24 alphanumeric characters).

**Response:** A complete `Response` object with `Content-Type: application/json`.

**Status codes:**

[cols="1,3"]
|===
| Code | Meaning

| 200
| Success.

| 400
| Malformed response ID.

| 404
| Response not found or has been deleted.

| 501
| No storage backend configured.
|===

=== GET /v1/responses

Lists stored responses with cursor-based pagination.
Requires a storage backend to be configured.

**Query parameters:**

[cols="1,1,1,3"]
|===
| Parameter | Type | Default | Description

| `limit`
| int
| 20
| Maximum number of responses to return (1-100).

| `order`
| string
| `desc`
| Sort order: `asc` or `desc`.

| `after`
| string
|
| Cursor: return responses created after this ID.

| `before`
| string
|
| Cursor: return responses created before this ID.

| `model`
| string
|
| Filter responses by model name.
|===

NOTE: The `after` and `before` parameters are mutually exclusive.

**Response:** A paginated list object with `Content-Type: application/json`.

[source,json]
----
{
  "object": "list",
  "data": [ ... ],
  "has_more": true,
  "first_id": "resp_abc123...",
  "last_id": "resp_xyz789..."
}
----

**Status codes:**

[cols="1,3"]
|===
| Code | Meaning

| 200
| Success.

| 400
| Invalid pagination parameters.

| 501
| No storage backend configured.
|===

=== DELETE /v1/responses/\{id}

Deletes a response by ID.
If the response is currently being streamed, this cancels the in-flight stream.
Otherwise, it performs a soft delete in storage.

**Path parameters:**

* `id` (string): The response ID.

**Response:** No body on success.

**Status codes:**

[cols="1,3"]
|===
| Code | Meaning

| 204
| Successfully deleted (or in-flight stream cancelled).

| 400
| Malformed response ID.

| 404
| Response not found.

| 501
| No storage backend configured (and no in-flight stream with this ID).
|===

=== GET /v1/responses/\{id}/input_items

Lists the input items for a stored response with cursor-based pagination.
Requires a storage backend to be configured.

**Path parameters:**

* `id` (string): The response ID.

**Query parameters:** Same as `GET /v1/responses` (`limit`, `order`, `after`, `before`).

**Response:** A paginated list object with `Content-Type: application/json`.

[source,json]
----
{
  "object": "list",
  "data": [ ... ],
  "has_more": false,
  "first_id": "item_abc123...",
  "last_id": "item_xyz789..."
}
----

**Status codes:**

[cols="1,3"]
|===
| Code | Meaning

| 200
| Success.

| 400
| Malformed response ID or invalid pagination parameters.

| 404
| Response not found.

| 501
| No storage backend configured.
|===

== Operational Endpoints

=== GET /healthz

Health check endpoint.
Returns a simple text response indicating the server is running.

**Response:**

----
ok
----

**Status codes:**

[cols="1,3"]
|===
| Code | Meaning

| 200
| Server is healthy.
|===

NOTE: This endpoint bypasses authentication and is always accessible.

=== GET /metrics

Prometheus metrics endpoint.
Only available when `observability.metrics.enabled` is `true` (the default).
The path is configurable via `observability.metrics.path`.

**Response:** Prometheus text exposition format with `Content-Type: text/plain`.

The gateway exposes the following metric families:

[cols="2,1,3"]
|===
| Metric | Type | Description

| `antwort_http_requests_total`
| counter
| Total HTTP requests by method, status class, and path.

| `antwort_http_request_duration_seconds`
| histogram
| Request duration in seconds by method and path.

| `antwort_streaming_connections_active`
| gauge
| Number of active SSE streaming connections.

| `gen_ai_client_token_usage`
| histogram
| Token usage per operation (input/output) following OTel GenAI semantic conventions.

| `gen_ai_client_operation_duration`
| histogram
| Provider operation duration in seconds.

| `gen_ai_client_time_to_first_token`
| histogram
| Time to first token for streaming responses.
|===

NOTE: This endpoint bypasses authentication and is always accessible.

== Request Headers

All API endpoints accept the following headers:

[cols="2,3"]
|===
| Header | Description

| `Content-Type`
| Must be `application/json` for POST requests.

| `Authorization`
| Bearer token for authentication (e.g., `Bearer sk-my-key`). Required when `auth.type` is not `none`.

| `X-Request-ID`
| Optional client-provided request ID. If present, it is propagated through the system and returned in the response headers.
|===

== Error Response Format

All error responses follow the OpenAI error format:

[source,json]
----
{
  "error": {
    "type": "invalid_request_error",
    "code": "invalid_value",
    "message": "A human-readable error description",
    "param": "field_name"
  }
}
----

Error types include `invalid_request_error`, `not_found_error`, and `server_error`.
